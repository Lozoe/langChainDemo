<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BGE-M3 Embedding çŸ©é˜µä¹˜æ³•è¯¦è§£</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "PingFang SC", "Microsoft YaHei", sans-serif;
            line-height: 1.8;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 40px 20px;
            color: #333;
        }

        .container {
            max-width: 960px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.97);
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            padding: 40px;
        }

        h1 {
            text-align: center;
            font-size: 28px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 30px;
        }

        h2 {
            font-size: 20px;
            color: #444;
            border-left: 4px solid #667eea;
            padding-left: 12px;
            margin: 30px 0 15px;
        }

        p {
            margin: 10px 0;
            color: #555;
        }

        code {
            background: #f0f0f5;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, monospace;
            font-size: 0.9em;
            color: #e83e8c;
        }

        pre {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 16px 20px;
            border-radius: 8px;
            overflow-x: auto;
            font-size: 14px;
            line-height: 1.6;
            margin: 12px 0;
        }

        .highlight {
            color: #66d9ef;
        }

        .comment {
            color: #75715e;
        }

        .string {
            color: #a6e22e;
        }

        ul {
            padding-left: 24px;
            margin: 10px 0;
        }

        li {
            margin: 4px 0;
            color: #555;
        }

        .diagram-section {
            margin: 25px 0;
            text-align: center;
        }

        .diagram-section h3 {
            font-size: 16px;
            color: #667eea;
            margin-bottom: 15px;
        }

        .mermaid {
            display: flex;
            justify-content: center;
        }

        .result-table {
            border-collapse: collapse;
            margin: 15px auto;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            overflow: hidden;
        }

        .result-table th,
        .result-table td {
            padding: 10px 18px;
            text-align: center;
            border: 1px solid #e0e0e0;
        }

        .result-table th {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: #fff;
            font-weight: 600;
        }

        .result-table td {
            background: #fafafe;
        }

        .high-sim {
            color: #27ae60;
            font-weight: bold;
        }

        .low-sim {
            color: #e74c3c;
        }

        .step-box {
            background: #f8f9ff;
            border: 1px solid #e0e4f5;
            border-radius: 10px;
            padding: 18px 22px;
            margin: 15px 0;
        }

        .formula {
            text-align: center;
            font-size: 18px;
            margin: 15px 0;
            padding: 12px;
            background: #f8f9ff;
            border-radius: 8px;
            font-family: "Georgia", serif;
            letter-spacing: 1px;
        }

        .note {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 12px 16px;
            border-radius: 0 8px 8px 0;
            margin: 15px 0;
            font-size: 14px;
            color: #856404;
        }
    </style>
</head>

<body>

    <div class="container">

        <h1>ğŸ§® BGE-M3 Embedding çŸ©é˜µä¹˜æ³•è¯¦è§£</h1>

        <!-- ==================== ç¬¬ä¸€éƒ¨åˆ†ï¼šä»£ç ä¸Šä¸‹æ–‡ ==================== -->
        <h2>ğŸ“ ä¸€ã€ä»£ç ä¸Šä¸‹æ–‡</h2>
        <p>åœ¨ <code>bge-m3ä½¿ç”¨.py</code> ä¸­ï¼Œå®šä¹‰äº†ä¸¤ç»„å¥å­ï¼š</p>

        <div class="step-box">
            <p><strong>ğŸ” æŸ¥è¯¢å¥å­ï¼ˆQueryï¼‰â€” sentences_1ï¼š</strong></p>
            <ul>
                <li>Q1: <code>"What is BGE M3?"</code></li>
                <li>Q2: <code>"Defination of BM25"</code></li>
            </ul>
            <p><strong>ğŸ“„ æ–‡æ¡£å¥å­ï¼ˆChunkï¼‰â€” sentences_2ï¼š</strong></p>
            <ul>
                <li>C1:
                    <code>"BGE M3 is an embedding model supporting dense retrieval, lexical matching and multi-vector interaction."</code>
                </li>
                <li>C2:
                    <code>"BM25 is a bag-of-words retrieval function that ranks a set of documents based on the query terms appearing in each document"</code>
                </li>
            </ul>
        </div>

        <!-- ==================== ç¬¬äºŒéƒ¨åˆ†ï¼šç¼–ç è¿‡ç¨‹ ==================== -->
        <h2>âš™ï¸ äºŒã€Embedding ç¼–ç è¿‡ç¨‹</h2>
        <p>BGE-M3 æ¨¡å‹å°†æ¯ä¸ªå¥å­ç¼–ç ä¸ºä¸€ä¸ª <strong>1024 ç»´</strong>çš„ç¨ å¯†å‘é‡ï¼ˆdense vectorï¼‰ï¼š</p>
        <pre>
<span class="comment"># ç¼–ç æŸ¥è¯¢å¥å­ â†’ å¾—åˆ° (2, 1024) çŸ©é˜µ</span>
embeddings_1 = model.encode(sentences_1)['dense_vecs']

<span class="comment"># ç¼–ç æ–‡æ¡£å¥å­ â†’ å¾—åˆ° (2, 1024) çŸ©é˜µ</span>
embeddings_2 = model.encode(sentences_2)['dense_vecs']
    </pre>

        <div class="step-box">
            <p>ç¼–ç ç»“æœï¼š</p>
            <ul>
                <li><code>embeddings_1</code>ï¼ˆæŸ¥è¯¢çŸ©é˜µ Qï¼‰ï¼šå½¢çŠ¶ <code>(2, 1024)</code> â€” 2 ä¸ªæŸ¥è¯¢ï¼Œæ¯ä¸ª 1024 ç»´</li>
                <li><code>embeddings_2</code>ï¼ˆæ–‡æ¡£çŸ©é˜µ Cï¼‰ï¼šå½¢çŠ¶ <code>(2, 1024)</code> â€” 2 ä¸ªæ–‡æ¡£ï¼Œæ¯ä¸ª 1024 ç»´</li>
            </ul>
        </div>

        <!-- ==================== ç¬¬ä¸‰éƒ¨åˆ†ï¼šçŸ©é˜µä¹˜æ³•æµç¨‹ ==================== -->
        <h2>ğŸ”¢ ä¸‰ã€çŸ©é˜µä¹˜æ³•æµç¨‹</h2>
        <p>æ ¸å¿ƒä»£ç åªæœ‰ä¸€è¡Œï¼š</p>
        <pre>similarity = embeddings_1 @ embeddings_2.T</pre>

        <p>è¿™è¡Œä»£ç æ‰§è¡Œäº†ä»¥ä¸‹æ“ä½œï¼š</p>

        <div class="diagram-section">
            <h3>æ•´ä½“æµç¨‹å›¾ï¼ˆMermaidï¼‰</h3>
            <div class="mermaid">
                graph TD
                subgraph è¾“å…¥å¥å­
                Q1["Q1: What is BGE M3?"]
                Q2["Q2: Defination of BM25"]
                C1["C1: BGE M3 is an..."]
                C2["C2: BM25 is a..."]
                end

                Q1 --> EQ["BGE-M3 ç¼–ç å™¨"]
                Q2 --> EQ
                C1 --> EC["BGE-M3 ç¼–ç å™¨"]
                C2 --> EC

                EQ --> E1["embeddings_1\næŸ¥è¯¢çŸ©é˜µ Q\nå½¢çŠ¶: 2 x 1024"]
                EC --> E2["embeddings_2\næ–‡æ¡£çŸ©é˜µ C\nå½¢çŠ¶: 2 x 1024"]

                E2 --> TR["è½¬ç½® .T\nå½¢çŠ¶: 1024 x 2"]

                E1 --> MM["çŸ©é˜µä¹˜æ³• @\nQ x C^T"]
                TR --> MM

                MM --> SIM["ç›¸ä¼¼åº¦çŸ©é˜µ\nå½¢çŠ¶: 2 x 2"]
            </div>
        </div>

        <!-- ==================== ç¬¬å››éƒ¨åˆ†ï¼šçŸ©é˜µä¹˜æ³•ç»†èŠ‚ ==================== -->
        <h2>ğŸ“ å››ã€çŸ©é˜µä¹˜æ³•ç»†èŠ‚ (SVG å¯è§†åŒ–)</h2>

        <div class="formula">
            similarity = Q<sub>(2Ã—1024)</sub> Ã— C<sup>T</sup><sub>(1024Ã—2)</sub> = Result<sub>(2Ã—2)</sub>
        </div>

        <div class="diagram-section">
            <svg width="820" height="520" viewBox="0 0 820 520" xmlns="http://www.w3.org/2000/svg"
                style="font-family: -apple-system, 'PingFang SC', sans-serif;">
                <!-- èƒŒæ™¯ -->
                <rect width="820" height="520" rx="12" fill="#fafafe" />

                <!-- ===== æŸ¥è¯¢çŸ©é˜µ Q (2x1024) ===== -->
                <g transform="translate(30, 80)">
                    <text x="90" y="-12" text-anchor="middle" font-size="14" font-weight="bold" fill="#4a56a6">æŸ¥è¯¢çŸ©é˜µ Q
                        (embeddings_1)</text>
                    <text x="90" y="6" text-anchor="middle" font-size="12" fill="#888">å½¢çŠ¶: 2 Ã— 1024</text>

                    <!-- çŸ©é˜µæ¡† -->
                    <rect x="0" y="20" width="180" height="80" rx="6" fill="#e8ecff" stroke="#4a56a6"
                        stroke-width="2" />
                    <line x1="0" y1="60" x2="180" y2="60" stroke="#4a56a6" stroke-dasharray="4" />

                    <!-- è¡Œæ ‡ç­¾ -->
                    <text x="90" y="46" text-anchor="middle" font-size="12" fill="#333">Q1 = [qâ‚â‚, qâ‚â‚‚, ...,
                        qâ‚,â‚â‚€â‚‚â‚„]</text>
                    <text x="90" y="78" text-anchor="middle" font-size="12" fill="#333">Q2 = [qâ‚‚â‚, qâ‚‚â‚‚, ...,
                        qâ‚‚,â‚â‚€â‚‚â‚„]</text>

                    <!-- ç»´åº¦æ ‡æ³¨ -->
                    <text x="-8" y="65" text-anchor="end" font-size="11" fill="#999"
                        transform="rotate(-90 -8 65)">2è¡Œ</text>
                    <text x="90" y="115" text-anchor="middle" font-size="11" fill="#999">1024 åˆ—ï¼ˆç»´åº¦ï¼‰</text>
                </g>

                <!-- ===== ä¹˜å· ===== -->
                <text x="245" y="155" font-size="28" font-weight="bold" fill="#764ba2">Ã—</text>

                <!-- ===== æ–‡æ¡£çŸ©é˜µè½¬ç½® C^T (1024x2) ===== -->
                <g transform="translate(280, 30)">
                    <text x="45" y="-5" text-anchor="middle" font-size="14" font-weight="bold" fill="#a6564a">æ–‡æ¡£çŸ©é˜µè½¬ç½®
                        C&#x1D40;</text>
                    <text x="45" y="13" text-anchor="middle" font-size="12" fill="#888">å½¢çŠ¶: 1024 Ã— 2</text>

                    <!-- çŸ©é˜µæ¡† -->
                    <rect x="0" y="25" width="90" height="180" rx="6" fill="#ffe8ec" stroke="#a6564a"
                        stroke-width="2" />
                    <line x1="45" y1="25" x2="45" y2="205" stroke="#a6564a" stroke-dasharray="4" />

                    <!-- åˆ—æ ‡ç­¾ -->
                    <text x="22" y="120" text-anchor="middle" font-size="11" fill="#333"
                        transform="rotate(-90 22 120)">C1 åˆ—å‘é‡</text>
                    <text x="68" y="120" text-anchor="middle" font-size="11" fill="#333"
                        transform="rotate(-90 68 120)">C2 åˆ—å‘é‡</text>

                    <!-- ç»´åº¦æ ‡æ³¨ -->
                    <text x="-12" y="115" text-anchor="end" font-size="11" fill="#999"
                        transform="rotate(-90 -12 115)">1024 è¡Œ</text>
                    <text x="45" y="225" text-anchor="middle" font-size="11" fill="#999">2 åˆ—</text>
                </g>

                <!-- ===== ç­‰å· ===== -->
                <text x="410" y="155" font-size="28" font-weight="bold" fill="#764ba2">=</text>

                <!-- ===== ç»“æœçŸ©é˜µ (2x2) ===== -->
                <g transform="translate(450, 80)">
                    <text x="80" y="-12" text-anchor="middle" font-size="14" font-weight="bold" fill="#27a660">ç›¸ä¼¼åº¦çŸ©é˜µ
                        (similarity)</text>
                    <text x="80" y="6" text-anchor="middle" font-size="12" fill="#888">å½¢çŠ¶: 2 Ã— 2</text>

                    <!-- çŸ©é˜µæ¡† -->
                    <rect x="0" y="20" width="160" height="80" rx="6" fill="#e8ffec" stroke="#27a660"
                        stroke-width="2" />
                    <line x1="0" y1="60" x2="160" y2="60" stroke="#27a660" />
                    <line x1="80" y1="20" x2="80" y2="100" stroke="#27a660" />

                    <!-- å€¼ -->
                    <text x="40" y="46" text-anchor="middle" font-size="13" font-weight="bold"
                        fill="#27ae60">0.6265</text>
                    <text x="120" y="46" text-anchor="middle" font-size="13" fill="#e74c3c">0.3477</text>
                    <text x="40" y="78" text-anchor="middle" font-size="13" fill="#e74c3c">0.3499</text>
                    <text x="120" y="78" text-anchor="middle" font-size="13" font-weight="bold"
                        fill="#27ae60">0.6780</text>

                    <!-- æ ‡ç­¾ -->
                    <text x="40" y="118" text-anchor="middle" font-size="10" fill="#999">C1</text>
                    <text x="120" y="118" text-anchor="middle" font-size="10" fill="#999">C2</text>
                    <text x="172" y="46" font-size="10" fill="#999">Q1</text>
                    <text x="172" y="78" font-size="10" fill="#999">Q2</text>
                </g>

                <!-- ===== è®¡ç®—ç»†èŠ‚åŒºåŸŸ ===== -->
                <g transform="translate(30, 310)">
                    <rect x="0" y="0" width="760" height="190" rx="10" fill="#f8f9ff" stroke="#e0e4f5"
                        stroke-width="1" />
                    <text x="20" y="28" font-size="15" font-weight="bold" fill="#4a56a6">ğŸ“Œ é€å…ƒç´ è®¡ç®—è¿‡ç¨‹ï¼š</text>

                    <!-- è®¡ç®—å…¬å¼ -->
                    <text x="20" y="60" font-size="13" fill="#333">
                        <tspan font-weight="bold" fill="#27ae60">similarity[0][0] = 0.6265</tspan>
                        <tspan dx="10" fill="#666">â† Q1 Â· C1 = qâ‚â‚Ã—câ‚â‚ + qâ‚â‚‚Ã—câ‚â‚‚ + ... + qâ‚,â‚â‚€â‚‚â‚„Ã—câ‚,â‚â‚€â‚‚â‚„ï¼ˆé«˜ç›¸ä¼¼åº¦ âœ…ï¼‰</tspan>
                    </text>
                    <text x="20" y="90" font-size="13" fill="#333">
                        <tspan font-weight="bold" fill="#e74c3c">similarity[0][1] = 0.3477</tspan>
                        <tspan dx="10" fill="#666">â† Q1 Â· C2 = qâ‚â‚Ã—câ‚‚â‚ + qâ‚â‚‚Ã—câ‚‚â‚‚ + ... + qâ‚,â‚â‚€â‚‚â‚„Ã—câ‚‚,â‚â‚€â‚‚â‚„ï¼ˆä½ç›¸ä¼¼åº¦ âŒï¼‰</tspan>
                    </text>
                    <text x="20" y="120" font-size="13" fill="#333">
                        <tspan font-weight="bold" fill="#e74c3c">similarity[1][0] = 0.3499</tspan>
                        <tspan dx="10" fill="#666">â† Q2 Â· C1 = qâ‚‚â‚Ã—câ‚â‚ + qâ‚‚â‚‚Ã—câ‚â‚‚ + ... + qâ‚‚,â‚â‚€â‚‚â‚„Ã—câ‚,â‚â‚€â‚‚â‚„ï¼ˆä½ç›¸ä¼¼åº¦ âŒï¼‰</tspan>
                    </text>
                    <text x="20" y="150" font-size="13" fill="#333">
                        <tspan font-weight="bold" fill="#27ae60">similarity[1][1] = 0.6780</tspan>
                        <tspan dx="10" fill="#666">â† Q2 Â· C2 = qâ‚‚â‚Ã—câ‚‚â‚ + qâ‚‚â‚‚Ã—câ‚‚â‚‚ + ... + qâ‚‚,â‚â‚€â‚‚â‚„Ã—câ‚‚,â‚â‚€â‚‚â‚„ï¼ˆé«˜ç›¸ä¼¼åº¦ âœ…ï¼‰</tspan>
                    </text>

                    <text x="20" y="178" font-size="12" fill="#856404">ğŸ’¡ æ¯ä¸ªç›¸ä¼¼åº¦å€¼ = ä¸¤ä¸ª 1024 ç»´å‘é‡çš„ç‚¹ç§¯ï¼ˆå³å¯¹åº”ç»´åº¦ç›¸ä¹˜åæ±‚å’Œï¼‰</text>
                </g>
            </svg>
        </div>

        <!-- ==================== ç¬¬äº”éƒ¨åˆ†ï¼šç»“æœè§£è¯» ==================== -->
        <h2>ğŸ“Š äº”ã€ç»“æœè§£è¯»</h2>

        <table class="result-table">
            <thead>
                <tr>
                    <th></th>
                    <th>C1: BGE M3 æ˜¯ä¸€ä¸ª...</th>
                    <th>C2: BM25 æ˜¯ä¸€ç§...</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><strong>Q1: What is BGE M3?</strong></td>
                    <td class="high-sim">0.6265 âœ… é«˜</td>
                    <td class="low-sim">0.3477 âŒ ä½</td>
                </tr>
                <tr>
                    <td><strong>Q2: Defination of BM25</strong></td>
                    <td class="low-sim">0.3499 âŒ ä½</td>
                    <td class="high-sim">0.6780 âœ… é«˜</td>
                </tr>
            </tbody>
        </table>

        <div class="note">
            <strong>ğŸ’¡ å…³é”®ç»“è®ºï¼š</strong><br />
            â€¢ å¯¹è§’çº¿å€¼ï¼ˆ0.6265ã€0.6780ï¼‰è¾ƒé«˜ â†’ è¯´æ˜æŸ¥è¯¢ä¸å¯¹åº”ä¸»é¢˜çš„æ–‡æ¡£åŒ¹é…åº¦é«˜<br />
            â€¢ éå¯¹è§’çº¿å€¼ï¼ˆ0.3477ã€0.3499ï¼‰è¾ƒä½ â†’ è¯´æ˜ä¸ç›¸å…³çš„æŸ¥è¯¢-æ–‡æ¡£å¯¹ç›¸ä¼¼åº¦ä½<br />
            â€¢ çŸ©é˜µä¹˜æ³•çš„æœ¬è´¨æ˜¯ï¼š<strong>æ‰¹é‡è®¡ç®—æ‰€æœ‰ Query-Chunk å¯¹ä¹‹é—´çš„ç‚¹ç§¯ç›¸ä¼¼åº¦</strong>ï¼Œä¸€æ¬¡æ€§å¾—åˆ°å®Œæ•´çš„ç›¸ä¼¼åº¦çŸ©é˜µ
        </div>

        <!-- ==================== ç¬¬å…­éƒ¨åˆ†ï¼šæ€»ç»“ ==================== -->
        <h2>ğŸ¯ å…­ã€æ€»ç»“</h2>

        <div class="diagram-section">
            <div class="mermaid">
                graph LR
                A["2 ä¸ªæŸ¥è¯¢å¥å­"] -->|BGE-M3 ç¼–ç | B["Q çŸ©é˜µ\n2 x 1024"]
                C["2 ä¸ªæ–‡æ¡£å¥å­"] -->|BGE-M3 ç¼–ç | D["C çŸ©é˜µ\n2 x 1024"]
                D -->|è½¬ç½®| E["C^T çŸ©é˜µ\n1024 x 2"]
                B -->|"@ çŸ©é˜µä¹˜æ³•"| F["ç›¸ä¼¼åº¦çŸ©é˜µ\n2 x 2"]
                E -->|"@ çŸ©é˜µä¹˜æ³•"| F
                F -->|å¯¹è§’çº¿é«˜| G["åŒ¹é…çš„ Query-Chunk å¯¹"]
                F -->|éå¯¹è§’çº¿ä½| H["ä¸åŒ¹é…çš„ Query-Chunk å¯¹"]
            </div>
        </div>

        <div class="step-box" style="text-align: center; font-size: 14px; color: #666;">
            <p><strong>æ ¸å¿ƒå…¬å¼ï¼š</strong> similarity<sub>(mÃ—n)</sub> = Q<sub>(mÃ—d)</sub> Ã— C<sup>T</sup><sub>(dÃ—n)</sub></p>
            <p>å…¶ä¸­ m = æŸ¥è¯¢æ•°é‡ï¼Œn = æ–‡æ¡£æ•°é‡ï¼Œd = å‘é‡ç»´åº¦ï¼ˆ1024ï¼‰</p>
            <p>ç»“æœçŸ©é˜µä¸­ similarity[i][j] è¡¨ç¤ºç¬¬ i ä¸ªæŸ¥è¯¢ä¸ç¬¬ j ä¸ªæ–‡æ¡£çš„ç›¸ä¼¼åº¦</p>
        </div>

    </div>

    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <script>
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default',
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true,
                curve: 'basis'
            }
        });
    </script>

</body>

</html>